# RUINS - ゲームシステム設計書

## 概要

このドキュメントは、RUINSのゲームシステム、メカニクス、技術仕様を記録するものです。
世界観・ストーリー設定については `../lore.md` を参照してください。

---

## ゲーム概要

### 基本コンセプト
遺跡を上へ上へと登っていくローグライクRPG。プレイヤーは探索者として危険な遺跡に挑みます。
ターン制での戦略的な探索、リソース管理、そして「昭和5年の日本」を連想させる親しみやすいアイテム群が特徴です。

### ジャンル・特徴
- **ジャンル**: ローグライクRPG（ターンベース）
- **視点**: 1人称レイキャスティング（3D風2D）
- **探索**: グリッドベース・ターン制移動
- **戦闘**: 同一マップ上でのターンベース統合戦闘
- **成長**: 装備・アイテム依存、経験値なし
- **言語**: 完全日本語対応

### 参考作品

#### Cataclysm: Dark Days Ahead (CDDA)
**参考にする要素:**
- **Action Points (AP) システム**: 敏捷性ベースのAP獲得、債務システム
- **地形コスト**: 移動コストの地形別差別化（平地100AP、茂み150AP等）
- **装備重量影響**: 重装備による移動・攻撃コスト増加
- **対角移動計算**: √2倍（142AP）の精密な移動コスト
- **親しみやすいアイテム**: 現実世界を連想させる道具群

#### Dark Souls
**採用する要素:**
- **通貨システム**: 購入資金「ソウル」システム
- **死亡ペナルティ**: 死亡時に通貨をドロップ、回収可能だが再度死ぬと消失
- **リスク管理**: 通貨を貯めることのリスクとリターン

---

## 核心的な面白さ

### プレイヤー体験の設計

#### 1. 「実在感ある世界での探索」
- 各アイテム・エリアに込められたフレーバーテキスト
- 「昭和5年の日本」という親しみやすい時代設定
- 見たことがある、聞いたことがある道具や場所
- テキストを読むこと自体が探索の楽しみになる設計

#### 2. 「意味のある選択とその結果」
数値最適化を超えた、感情的な判断を伴う選択システム。

**具体的なジレンマ:**
- **橋の選択**: 3つの橋から次のフロアを選ぶ
- **重量管理**: 貴重品（高価格・重い） vs 実用品（便利・軽い）
- **リスク判断**: HP残量 vs 未探索エリアの誘惑
- **追跡者対策**: 逃げる、迎撃する、時間稼ぎする

#### 3. 「プレイヤー成長による体験質の向上」
パーマデスでありながら、継続的な成長を実感できるシステム。

**二重成長システム:**
- **知識の成長**: 失敗からの学習が次回プレイの戦略につながる
- **装備の蓄積**: ステータスリセット + 装備持ち越しによる新しい進歩感
- **愛着の形成**: 苦労して手に入れた装備が次回冒険の支えになる

---

## ステージ遷移システム

### シームレスな橋選択式

#### 基本構造

**プレイヤーは常に「上」を目指す**

```
【構造イメージ】
        ゴール（100階）
           ↑
      ┌────┼────┐
      橋A  橋B  橋C    ← プレイヤーが選択
      └────┼────┘
         フロア
           ↑
      ┌────┼────┐
      橋1  橋2  橋3
      └────┼────┘
       初期位置（1階）
```

#### 橋の選択

**通常フロア（1-4階、6-9階、等）:**
- フロアの上部に**3つの橋**が配置されている
- それぞれの橋は次のフロア（異なるステージ）に繋がっている
- 橋を渡る前に、ゲームログで次フロアの情報が表示される
  - 「焦げた匂いがする...」 → 火災エリア
  - 「機械音が響いている...」 → 工場エリア
  - 「木々のせせらぎが聞こえる...」 → 自然エリア
- 橋に到達すると起動に**10ターン**かかる（すぐ逃げられない）
- 起動中は防衛が必要
- 一度渡ったら**戻れない**（一方通行）

**5階ごとの休憩フロア（5階、10階、15階、等）:**
- フロアの上部に**4つの橋**が配置される
- 3つは次のフロアへ、1つは**街へ戻る橋**
- 街に戻れば装備購入、回復、セーブが可能
- ただし街に戻ると探索は最初からやり直し

#### フロア内の探索

- **自由な移動**: 橋に到達するまで、フロア内を自由に歩き回れる
- **迷路ではない**: 基本的に迷うことはなく、上を目指せば橋に到達
- **探索重視**: じっくり隅々まで探索することも可能
- **速攻重視**: 最短ルートで橋へ直行することも可能
- **追跡者**: 下の橋から追ってきた敵もそのまま来る

#### 内部処理

**シームレスに見えるが:**
- 橋を渡る瞬間に次のフロアをマップ生成
- 濃い霧の演出で切り替えをカモフラージュ
- プレイヤーには「上に登り続けている」感覚

---

## 定期的な脅威システム

### 追跡者（Pursuer）

#### 基本メカニズム

```
【通知】
「遥か下層から何かが近づいている...」
「あと20ターンで到達する」

【カウントダウン】
画面に残りターン数が表示される

【対処の選択】
1. 迎撃準備: アイテム収集、有利な地形確保
2. 速攻逃走: 橋へ急ぐ（起動に10ターン必要）
3. 損切り判断: アイテムを捨てて身軽に
```

#### 逃げにくくする仕組み

**1. 橋の起動時間（10ターン）**
- 橋に到達しても即座に渡れない
- 起動中は防衛が必要
- 起動を中断すると最初からやり直し

**2. 橋までの距離**
- フロアの端に橋がある
- 現在地から橋まで移動に時間がかかる
- 途中に敵や障害物がある

**3. 荷物による移動速度低下**
- アイテムを持つほど移動が遅くなる
- 重装備: 1マス移動に3ターン必要
- 軽装備: 1マス移動に1ターン
- **損切り判断**: 「アイテムを捨てて逃げるか」

**4. 追跡者の種類**

```
【殲滅型】
倒さないと永遠に追ってくる
報酬: 大

【時限型】
一定ターン耐えれば諦めて去る
報酬: 中

【略奪型】
プレイヤーのアイテムを奪って去る
戦闘回避可能、報酬: 小

【偵察型】
倒せば報酬大、逃げれば次フロアで増援
```

#### 追跡者の頻度

- **10階ごと**に確定で出現
- 他はランダム（確率30%）
- 事前に10-20ターン前に通知

---

## アイテムとステージの設計原則

### 慣れ親しんだ文脈

**CDDAが面白い理由の本質:**
> 都市の慣れ親しんだ土地で、見知ったアイテムを収集すること

**Ruinsへの適用:**
- **80%は「昭和5年の日本」**: プレイヤーが理解できる範囲
- **20%は謎アイテム**: 古代技術、探索の驚き

### アイテム例

#### 理解しやすいアイテム（80%）

```
【武器】
- 軍刀（制式採用の日本刀）
- 銃剣（旧式の武器）
- 鉄パイプ（即席武器）

【防具】
- 鉄兜（軍用ヘルメット）
- 作業衣（工場労働者の服）
- 防弾チョッキ（試作品）

【消耗品】
- 包帯（医療用）
- 消毒液（アルコール）
- 配給の缶詰（食料）

【換金品】
- 古代銭（銅製）
- 書類の束
- 軍刀の鞘
```

#### 謎アイテム（20%）

```
【古代技術】
- 地髄結晶（発光する結晶）
- 古代の太刀（青く光る刀）
- 地髄アンプル（高度な治療薬）
- 地髄合金の破片（未知の素材）
```

### ステージ例

#### 施設系ステージ（理解しやすい）

```
【軍需工場】
→ 工具、金属部品、鉄くず、設計図
→ 「工場らしさ」が自然に想像できる

【病院跡】
→ 医療品、包帯、消毒液、診断書
→ 「病院らしさ」が分かる

【学校跡】
→ 教科書、文房具、体育用具
→ 「学校らしさ」が予測できる

【商店街】
→ 日用品、食料、雑貨
→ 「商店街らしさ」が想像できる

【鉱山】
→ つるはし、ランタン、鉱石
→ 「鉱山らしさ」が分かる
```

#### 場所とアイテムの自然な一致

```
軍需工場 → 工具、金属（当たり前）
病院 → 医療品（当たり前）
学校 → 文房具（当たり前）

→ 「当たり前」だからこそ納得感がある
→ CDDAと同じ「慣れ親しんだ文脈」
```

### アイテム数の方針

**質 > 量**

```
❌ 悪い例
「剣A」「剣B」「剣C」...（30種類）
→ 違いが分からない、圧倒される

✅ 良い例
「軍刀」（昭和の制式）
「古代の太刀」（地髄で光る）
「地髄剣」（高出力）
→ 各アイテムが明確に異なる
→ 覚えられる量
```

**目標: 数百種類**
- CDDAの数千種類は目指さない
- 厳選されたアイテム
- 各アイテムが記憶に残る

## ターンベース探索システム

### 基本仕様
- **グリッド移動**: 1マス単位での移動
- **アクションコスト**: 全行動に時間コストを設定
- **ターン制**: プレイヤー行動→敵行動の繰り返し
- **統合戦闘**: 探索マップ上で直接戦闘実行
- **レイキャスト表示**: 1人称視点は維持

### アクションコストシステム（CDDA準拠）

**基本メカニズム:**
- **APの獲得**: 毎ターン開始時に「敏捷性」値分のAPを獲得
- **基本移動コスト**: 通常地形での1マス移動 = 100AP
- **ターン終了条件**: APが0以下になるとターン終了

**行動コスト例:**
```
基本行動:
- 移動（平地）: 100AP
- 移動（対角）: 142AP（√2倍）
- 通常攻撃: 100AP
- 重武器攻撃: 150-300AP
- アイテム使用: 80-120AP
- 装備変更: 200AP
```

**CDDA式債務システム:**
```
例：敏捷性100、重武器攻撃250APの場合

ターン1:
- 攻撃実行（250AP消費）
- 残りAP: 100 - 250 = -150
- ターン終了（APが負の値）

ターン2:
- 敏捷性分AP獲得: +100
- 現在AP: -150 + 100 = -50（まだ負）
- 即座にターン終了

ターン3:
- 敏捷性分AP獲得: +100
- 現在AP: -50 + 100 = +50
- 行動可能（50APで行動開始）
```

**コスト調整要素:**
- **地形**: 難地形での移動コスト増加（茂み150AP、沼地200AP）
- **装備重量**: 重装備時の移動・攻撃コスト増加
- **状態異常**: 毒、疲労、負傷による速度低下

---

## 統合戦闘システム

### 特徴
- **マップ統合**: 探索画面で直接戦闘実行
- **スキル選択**: 多様な攻撃手段をターン内で選択
- **レンジ戦闘**: 遠距離・近距離攻撃を距離に応じて実装
- **位置戦略**: マップの地形・障害物を活用

### 攻撃タイプ
- **近接攻撃**: 隣接マスの敵を攻撃
- **遠距離攻撃**: 射線上の敵を攻撃（射程制限あり）
- **範囲攻撃**: 複数マスの敵に同時攻撃
- **魔法攻撃**: 壁越し攻撃、状態異常付与

---

## アイテム・クラフトシステム

### アイテム構成

**目標: 数百種類（厳選）**
- **武器**: 30種類程度（近接、銃器、古代武器）
- **防具**: 20種類程度（頭部、胴体、脚部、装飾品）
- **消耗品**: 15種類程度（回復系、戦闘系、バフ系）
- **クラフトレシピ**: 50種類程度
- **素材**: 20種類程度

### 購入と合成の棲み分け

**基本方針:**
- **購入**: 安定した基礎固め、保険的役割
- **合成**: ガチャ要素、やり込み要素

**購入システム（店での購入）**
- **確実性**: 必要な装備を確実に入手できる
- **初期装備**: ゲーム序盤の基本装備供給源
- **価格**: 基本価値の2倍（高コスト）
- **性能**: 基本性能が低め・安定

**合成システム（クラフト）**
- **やり込み要素**: 高性能装備を狙う目標
- **素材収集の動機**: ダンジョン探索の目的を増やす
- **ランダム性**: 性能にランダム補正（-10～+9等）
- **コスト**: 素材収集に時間がかかる

### 重量管理システム
プレイヤーの感情的判断を促す核心システム：
- 貴重品（高価格・重い）と実用品（便利・軽い）の取捨選択
- インベントリ圧迫時の「何を捨てるか」判断
- 追跡者から逃げる時の「アイテムを捨てて逃げるか」判断

---

## キャラクター・ステータス

### ステータス
- **体力 (Vitality)**: HP、生存力
- **筋力 (Strength)**: 物理攻撃力
- **感覚 (Sensation)**: 魔法攻撃力、知覚
- **器用 (Dexterity)**: 命中率、魔法命中
- **敏捷 (Agility)**: 行動順、回避率、AP回復量
- **防御 (Defense)**: 物理・魔法軽減

---

## 通貨システム

### ダークソウル式通貨システム

Dark Soulsの「ソウル」を参考にした、収集自体に意味を持つ特色ある通貨システム。

**基本コンセプト:**
- 通貨でアイテムを売却/購入しパワーアップしていく
- 探索、戦闘、発見の全てが通貨獲得につながる
- 「何に使うか」の戦略的選択がゲームプレイの核心

### 通貨の用途

1. **アイテム購入**: 商人NPCからの購入
2. **装備強化**: 武器・防具の強化
3. **特殊サービス**: アイテム識別、能力解放

### 死亡時のメカニクス

**Dark Souls式のリスク・リターンシステム:**

```
【死亡時】
├─ 所持通貨を全てその場に落とす
├─ プレイヤーは通貨0で復活
└─ 死亡地点にマーカー表示

【回収フェーズ】
├─ 死亡地点まで戻れば全額回収可能
├─ 回収前に再度死亡 → 前回の通貨は完全消失
└─ フロア移動で回収不可になる可能性
```

**心理的緊張感の創出:**
- 大量の通貨を持つほど死亡リスクが重くなる
- 「いま使うべきか、貯めるべきか」の判断
- 「回収に戻るか、諦めて先に進むか」の選択

---

## ローグライク要素

### パーマデス・成長システム
- **完全ロスト**: 死亡時はゲーム最初から
- **メタ進行**: 装備持ち越しのみ、ステータスリセット
- **学習成長**: プレイヤー自身の戦略的知識蓄積
- **装備愛着**: 苦労して得た装備への感情的価値

### 戦略的リスク管理

**重量管理の葛藤**
- 貴重品（高価格・重い） vs 実用品（便利・軽い）
- インベントリ圧迫時の取捨選択
- 追跡者から逃げる時の損切り判断

**リスク管理の心理戦**
- HP残量 vs 未探索エリアの誘惑
- 橋の起動中の防衛判断
- アイテム残量と敵遭遇リスクのバランス

**選択の重み**
- 橋の選択（3つから1つ）
- 戦闘回避（安全） vs 迎撃（リスク・報酬）
- 重装備（防御重視・移動遅い） vs 軽装備（機動性・防御脆弱）

---

## 開発計画

### 実装フェーズ

#### Phase 1: 橋選択システム
- 3つの橋選択UI
- 橋の起動時間（10ターン）
- 次フロアの情報表示（匂い、音）

#### Phase 2: 追跡者システム
- 追跡者の通知とカウントダウン
- 荷物による移動速度調整
- 追跡者の種類とバリエーション

#### Phase 3: 施設系マップ生成
- ASCIIテンプレートの作成
- パレットシステム
- ランダム要素の実装

#### Phase 4: アイテム実装
- 昭和5年の日本アイテム（80%）
- 古代技術アイテム（20%）
- フレーバーテキスト

### 現在の開発状況

#### 実装済み機能 ✅
- ダンジョン探索（1人称視点、レイキャスティング）
- ターンベース戦闘システム
- インベントリ管理
- クラフトシステム
- 装備システム
- セーブ/ロード機能
- キーボード操作

---

## 想定プレイ時間

- **1セッション**: 30分〜1時間（5階ごとの休憩点）
- **1周**: 2〜4時間（プレイヤースキルにより変動）
- **全体体験**: プレイヤー成長により無限に楽しめる設計

---

## 設計の核心

### 3つの柱

**1. 親しみやすさ**
- 昭和5年の日本という見知った世界
- 「工場」「病院」「学校」という想像しやすい場所
- 「軍刀」「鉄兜」「包帯」という理解できる道具

**2. 選択の重み**
- 橋の選択（戻れない一方通行）
- 追跡者への対処（逃げる、戦う、時間稼ぎ）
- アイテムの取捨選択（重量管理）

**3. 緊張感と成長**
- 追跡者のカウントダウン
- 橋の起動時間
- パーマデスと装備持ち越し

これらが組み合わさることで、「毎回異なる体験」と「着実な成長」を両立します。
