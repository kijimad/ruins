# 戦闘システムを再設計する

## コンセプト

ゲーム全体のコアはアイテム収集と活用である。豊富なアイテム収集のモチベーションとして戦闘がある。多くのアイテムは違った形で有利な戦闘に貢献する。

戦闘は「メリハリの効いた敵ごとに最適な武器を切り替える」パズル的な面白さを重視する。演出や手間は最小限で、テンポ良く、あっさりでよい。

## 設計原則

### 1. 敵の多様性

```
[敵タイプ]
ゴブリン弓兵: 遠距離、脆い → ショットガン、ハンドガン
オークウォリアー: 高HP、近接 → 遠距離で削る → 日本刀
スライム: 物理耐性 → 火炎瓶
ゴースト: 物理無効 → 魔法武器
群れラット: 大量、速い → ショットガン、火炎瓶

最適な武器を切り替えるのがパズル
```

### 2. アイテム収集の価値

```
[武器を手に入れる = 戦術が増える]
ショットガン入手:
→ 群れに対処できるようになる
→ 新しいエリアに挑戦できる
→ 収集の価値を実感

火炎瓶入手:
→ スライムを倒せるようになる
→ 物理耐性持ちに対処可能
→ 戦術が広がる
```

### 3. 武器切り替え

```
[核心メカニクス]
- 5つの武器スロット（1-5キー）
- 数字キーで即座に切り替え
- Shift + 方向キーで攻撃
- 敵ごとに最適な武器が異なる

[例]
ゴブリン弓兵×3発見
→ 3キー: ショットガン切り替え
→ Shift + →: 範囲攻撃
→ 3体同時撃破
→ 気持ち良い！
```

### 4. 学習曲線

```
[初心者]
→ 武器を切り替えない
→ 日本刀だけで戦う
→ 弓兵に撃たれまくる

[中級者]
→ 「弓兵にはハンドガン」を学ぶ
→ 基本的な使い分けができる

[上級者]
→ 敵を見て即座に最適な武器に切り替え
→ 「群れが来る → ショットガン待機」
→ 先読みして準備、無駄なく処理
→ フロー状態、気持ち良い
```

## 戦闘フロー（シームレス）

### 基本フロー

```
1. 敵を発見
   ↓
2. 適切な武器に切り替え（1-5キー）
   ↓
3. 攻撃（Shift + 方向キー）
   ↓
4. 戦闘ログに結果表示
   「ゴブリンにショットガンで攻撃 → 25ダメージ」
   ↓
5. 敵のターン
   「ゴブリンの反撃 → 8ダメージを受けた」
   ↓
6. 繰り返し
```

### 戦闘例1: 混合部隊

```
[敵構成]
- ゴブリン弓兵×2（距離10, 12）
- オークウォリアー×1（距離6）

[プレイヤーの判断]
1. 5キー → 煙幕使用
   → 弓兵の攻撃無効化（3ターン）

2. 2キー → ハンドガン装備

3. Shift + → → オークを遠距離攻撃
   「オークに15ダメージ」

4. オークが接近（距離2）

5. 1キー → 日本刀装備

6. Shift + → → オーク撃破
   「オークに35ダメージ → 撃破」

7. 2キー → ハンドガン装備

8. 弓兵を順次撃破
```

### 戦闘例2: 群れ

```
[敵構成]
- ラット×8（距離3-5）

[プレイヤーの判断]
1. 3キー → ショットガン装備

2. Shift + → → 範囲攻撃
   「ラット×3に20ダメージずつ → 撃破」

3. Shift + → → 範囲攻撃
   「ラット×3に20ダメージずつ → 撃破」

4. 1キー → 日本刀装備

5. 残り2体を近接処理
```

## 戦闘の特徴

### シームレス戦闘
- 移動と同じ感覚で攻撃
- Shift + 方向キーで即座に実行
- テンポが良い、フロー状態に入れる
- 武器切り替えが判断の核心

### 武器の特性

```
[近接武器]
日本刀: 高ダメージ、単体、耐久消費
斧: 中ダメージ、壁破壊可能

[遠距離武器]
ハンドガン: 中ダメージ、正確、汎用
ショットガン: 高ダメージ、範囲3マス、弾薬高コスト
ライフル: 高ダメージ、長射程、正確

[消費アイテム]
火炎瓶: 固定ダメージ、範囲、継続ダメージ、スライム特効
煙幕: 遠距離攻撃無効化3ターン、弓兵対策
手榴弾: 固定30ダメージ、範囲、壁破壊可能
```

### 敵の特性

```
[ゴブリン弓兵]
HP: 低、遠距離攻撃、脆い
弱点: 近距離、範囲攻撃
対策: ショットガン、ハンドガン、煙幕

[オークウォリアー]
HP: 高、近接特化、遅い
弱点: 遠距離
対策: 遠距離で削る、近づかれたら日本刀

[スライム]
HP: 中、物理耐性50%、魔法弱点
弱点: 火、魔法
対策: 火炎瓶、魔法武器

[ゴースト]
HP: 低、物理無効、壁抜け、魔法弱点
弱点: 魔法、聖水
対策: 魔法武器、聖水

[群れラット]
HP: 極低、大量出現、速い
弱点: 範囲攻撃
対策: ショットガン、火炎瓶
```

### 逃亡と地形操作
- 戦闘中でも移動可能（逃げられる）
- Shift + 方向キーで壁破壊（斧装備時）
- 地形を利用した戦術
- ドアや通路で1体ずつ処理

## 操作方法

### 基本操作（キーボードのみ）

ゲームシステムは一貫性を保つため、キーボードのみで操作する。

```
[通常マップ画面]
- 移動: ↑↓←→
- 攻撃: Shift + 方向キー
- 武器切り替え: 1-5キー
- アイテム拾得: Enter
- メニュー: i (インベントリ), c (キャラクター) など
```

### 武器切り替えと攻撃

```
[HUD表示 - マインクラフト風ツールバー]

┌──────────────────────────────────────┐
│                                      │
│           [マップ表示領域]           │
│                                      │
└──────────────────────────────────────┘

HP: 45/60  AP: 3/5  弾薬: 24/50

┌───┬───┬───┬───┬───┐
│ 1 │ 2 │ 3 │ 4 │ 5 │  ← 数字キー
├───┼───┼───┼───┼───┤
│🗡 │🔫│🔫│🔥│💨│  ← アイコン
├───┼───┼───┼───┼───┤
│ 刀│ H │ S │瓶│煙│  ← 略称
├───┼───┼───┼───┼───┤
│ ∞ │24 │8  │3 │2 │  ← 残数/弾薬
└───┴───┴───┴───┴───┘
  ▲
  選択中（枠が光る、または反転表示）

[操作]
1. 1-5キー: 武器切り替え
   → ツールバーの選択枠が移動
   → 「ショットガンに切り替えた」

2. Shift + 方向キー: 攻撃
   → 選択中の武器で攻撃
   → 「ゴブリンにショットガンで攻撃 → 25ダメージ」

3. 敵のターン
   「ゴブリンの反撃 → 8ダメージを受けた」
```

### 戦闘の流れ

```
[シナリオ: ゴブリン弓兵×3遭遇]

1. 敵を発見（距離8）

2. 3キー押下
   → ショットガンに切り替え
   → HUDの★が[3]に移動

3. Shift + → 押下
   → 範囲攻撃発動
   → 「ゴブリン×3に20ダメージずつ → 全滅」
   → 1回の攻撃で処理、気持ち良い！

4. 弾薬消費
   → ショットガン (弾薬:8) → (弾薬:7)
```

### キーボード操作を選択した理由

1. **一貫性**: すべての操作（移動、アイテム、メニュー）がキーボードで完結
2. **速度**: マウスに手を移動させる必要がなく、素早い判断と実行が可能
3. **確実性**: 意図した対象を確実に選択できる
4. **シンプルさ**: マウス入力システムの実装が不要で、コアロジックに集中できる
5. **ローグライク的**: 伝統的なローグライクの操作体系に沿っている

## UIイメージ

```
========================================
[ゲーム画面 - マインクラフト風レイアウト]

┌──────────────────────────────────────┐
│ ■■■■■■■■■■■■■■■■■■■│
│ ■........■..G.....■........■       │  マップ
│ ■...@....+........■........■       │  表示
│ ■........■.GG.....■........■       │  領域
│ ■■■+■■■■■+■■■■■■■■│
└──────────────────────────────────────┘

HP: 45/60  AP: 3/5  弾薬: 24/50

┌───┬───┬───┬───┬───┐
│ 1 │ 2 │ 3 │ 4 │ 5 │  ツールバー
├───┼───┼───┼───┼───┤
│🗡 │🔫│🔫│🔥│💨│  (横並び)
├───┼───┼───┼───┼───┤
│ 刀│ H │ S │瓶│煙│
├───┼───┼───┼───┼───┤
│ ∞ │24 │8  │3 │2 │
└───┴───┴───┴───┴───┘
  ▲ 選択中

[戦闘ログ（下部）]
> ゴブリンにショットガンで攻撃
  → ゴブリン×3に20ダメージ → 撃破
> 8経験値を獲得
========================================
[操作]
移動: ↑↓←→
攻撃: Shift + 方向キー
武器切り替え: 1-5キー
```

```
========================================
[戦闘シーン例]

1. ゴブリン×3発見

   G G G

     @

2. 3キー押下 → ショットガン切り替え
   HUDの★が[3]に移動

3. Shift + ↑ 押下

   範囲攻撃！

   ×G×G×G
     ║
     @

   戦闘ログ:
   「ゴブリン×3にショットガンで攻撃」
   「ゴブリンAに20ダメージ → 撃破」
   「ゴブリンBに20ダメージ → 撃破」
   「ゴブリンCに20ダメージ → 撃破」
   「24経験値を獲得」

   気持ち良い！
```

## 戦闘ロジック（簡略版）

### ダメージ計算

```go
// 基本ダメージ
BaseDamage = 武器攻撃力 + プレイヤー攻撃力 - 敵防御力

// 特性による補正
if 敵.物理耐性 > 0 && 武器.Type == Physical {
    BaseDamage *= (1 - 敵.物理耐性/100)
}

if 敵.火弱点 && 武器.Type == Fire {
    BaseDamage *= 1.5  // 火弱点なら1.5倍
}

// 範囲攻撃
if 武器.Area > 0 {
    範囲内の全敵にダメージ
}

// 最終ダメージ
FinalDamage = BaseDamage * (0.9 + rand(0.2))  // ±10%のランダム性
```

### 敵のAI（シンプル）

```go
// 敵のターン
if プレイヤーが視界内 {
    if 距離 <= 射程 {
        攻撃()
    } else {
        プレイヤーに近づく()
    }
} else {
    ランダムに移動()
}
## 実装の優先順位

### Phase 1: 最小構成（MVP）

```
目標: 1つの武器で1つの敵と戦える

1. 武器スロットコンポーネント追加
   - WeaponSlots: [5]*Weapon
   - Active: 現在装備中のインデックス

2. 武器データ定義
   - 日本刀のみ（近接）
   - 基本的な攻撃力のみ

3. HUDに武器スロット表示
   - [1] 日本刀 ★
   - シンプルな表示

4. 攻撃アクション実装
   - Shift + 方向キー
   - 隣接敵への攻撃のみ
   - ダメージ計算（武器攻撃力 - 敵防御力）

5. 戦闘ログ表示
   - 「ゴブリンに日本刀で攻撃 → 15ダメージ」
   - 「ゴブリンの反撃 → 8ダメージ」

→ ここまでで動作確認、面白さを検証
```

### Phase 2: 武器切り替えと多様性

```
目標: 複数の武器を切り替えて戦う醍醐味を実装

1. 武器追加
   - ハンドガン（遠距離）
   - ショットガン（範囲）

2. 武器切り替え機能
   - 1-5キーで切り替え
   - HUDの★表示が移動

3. 遠距離攻撃実装
   - 射程チェック
   - 弾薬消費

4. 範囲攻撃実装
   - Area指定
   - 複数敵へのダメージ

→ 武器切り替えの面白さを検証
```

### Phase 3: 敵の多様性

```
目標: 敵ごとに最適な武器が異なる状況を作る

1. 敵の特性追加
   - 物理耐性
   - 火弱点
   - 遠距離攻撃持ち

2. 武器の特殊効果
   - 火炎瓶（火属性）
   - 煙幕（防御バフ）

3. 敵AIの改善
   - 距離に応じた行動
   - 遠距離攻撃持ちの挙動

→ 敵ごとに武器を切り替える必要性を検証
```

### Phase 4: 調整とバランス

```
1. 数値調整
   - ダメージバランス
   - 弾薬コスト
   - 敵のHP

2. UI改善
   - 敵のHP表示
   - ダメージ予測

3. エフェクト追加
   - 攻撃アニメーション
   - ダメージ数値表示

→ 全体のバランスと気持ち良さを調整
```
