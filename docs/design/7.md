# 極寒環境サバイバルローグライク設計

## コンセプト

```
The Long Dark × ローグライク × 現代の遭難

極寒の雪山を探索するターンベースローグライク
「寒さ」が中心的な脅威
属性ベースシミュレーション + ターンベース + Emergent Narrative
```

## なぜ極寒が優れているか

```
放射線:                          寒さ:
❌ 見えない                      ✅ 誰でも経験がある
❌ 実感しづらい                  ✅ 体感として理解できる
❌ 単位が分かりにくい（mSv）     ✅ 単位が分かりやすい（-30℃）
❌ 対策が専門的（除染剤）        ✅ 対策も直感的（火を起こす、服を着る）
❌ 視覚表現が抽象的              ✅ 雪、氷、火が美しい
                                 ✅ The Long Darkが実績を証明
                                 ✅ 現代設定で多様なアイテム・施設を登場させやすい
```

## 世界観：現代の雪山遭難

```
設定:
- スキーリゾートや登山ツアーで突然遭難
- 通信途絶、救援なし
- 山中には廃棄された研究施設や小屋が点在
- 生存には山を下りる必要がある

テーマ:
「生存への拡張」
「自然との対峙」
「希望と判断の天秤」

現代設定の雰囲気:
- 廃棄施設、小屋、駐車場
- 熊、狼、雪崩
- 冷静な判断の必要性

なぜこの世界観か:
✅ アイテムを説明なしで登場させやすい（現代の装備・食料・薬）
✅ ローグライクの「深く潜る」構造と相性良い
✅ 敵のバリエーション（動物、自然現象、(-30℃の環境自体)）
✅ 視覚的に美しい
✅ 設定の縛りなし（新しいアイテム・施設を自由に追加可能）
```

## 設計哲学

### 1. 属性ベースシミュレーション（ランダム生成の可能化）

```
パズル型（ランダム生成不可）:
「スイッチAを押す→扉Bが開く→敵Cが出現」
→ 固定された因果関係

シミュレーション型（ランダム生成可能）:
「寒さは徐々に体温を奪う」
「火は周囲を温める」
「濡れた服の保温性は低下する」
→ 汎用的なルール
→ どんな配置でも機能する
→ プレイヤーは「ルール」だけ覚えればいい
```

### 2. ターンベース

```
✓ 思考時間が取れる（環境を観察できる）
✓ シミュレーションと相性が良い
✓ 因果関係が明確
✓ ローグライクの伝統
```

### 3. Emergent Narrative（物語生成）

```
脚本を書くのではなく、
プレイヤーの行動とシミュレーションから
自然に物語が生まれる

例：
「狼の群れに追われて屋内に逃げ込んだが、
 火を起こしようとしたら強風で着火に失敗。
 急いで薪をもう1本使ったがそれも失敗。
 最後のマッチを擦ると火がついた。
 狼はその火を恐れて撤退した。
 息を整えながら、薪の残り2本を見つめた。」

→ プレイヤーが語りたくなる体験
→ 毎回異なる
```

### 4. FTL型リソース交換

```
複数のリソースが相互に変換可能
「何かを犠牲にすることで別のリソースを獲得」

例：
- 防寒装備を着る → 体温維持だが戦闘不利
- 装備を脱く → 逃走速度UP だが体温急降下
- 薪を燃やす → 暖かさを得る だが燃料消耗
- 酒を飲む → 一時的に温かい だが実際には体温lowering

プレイヤースキルで不利を覆せる
```

### 5. The Long Dark型の緊張感

```
ソフトな時間制約:
「体温が限界に近い、そろそろ帰還を」
でも完全なゲームオーバーではない
火を起こせば体温回復可能
ただし薪は有限

「もう少し」の誘惑:
「もう1つの建物を探索したら帰ろう」
→ 欲との戦い
→ 引き際の判断
→ 欲張ると死ぬ

デススパイラル:
1. 薪が尽きる
2. 火を起こせない
3. 体温急降下
4. 移動速度低下
5. 帰還間に合わない
6. 死

→ 早めの判断が重要
→ 手遅れになる前に行動
```

## コアシステム

### 1. プレイヤーのニーズ（RimWorld型）

```go
type PlayerNeeds struct {
    // 生存ニーズ（重要度：高）
    Hunger      float64  // 0-100  空腹（常に減る）
    Thirst      float64  // 0-100  渇き（空腹より早く減る）
    Warmth      float64  // 0-100  温かさ（環境に依存）
    Rest        float64  // 0-100  休息（活動で減る）

    // 快適性ニーズ（重要度：中）
    Comfort     float64  // 0-100  快適さ
    Morale      float64  // 0-100  士気
    Pain        float64  // 0-100  痛み

    // 環境ニーズ（重要度：低）
    Beauty      float64  // 0-100  美しさ
}

// 毎ターン更新
func UpdateNeeds(player *Player) {
    player.Needs.Hunger -= 0.5
    player.Needs.Thirst -= 0.8
    player.Needs.Warmth -= 1.0    // 極寒で最も速く減る
    player.Needs.Rest -= 0.3

    // 閾値を超えるとペナルティ
    if player.Needs.Hunger < 20 {
        player.MaxStamina *= 0.7
    }
    if player.Needs.Warmth < 30 {
        player.MovementSpeed *= 0.8
    }
    if player.Needs.Rest < 10 {
        player.AccuracyPenalty += 0.3
    }

    // 複数のニーズが低いとデススパイラル
    lowCount := 0
    if player.Needs.Hunger < 30 { lowCount++ }
    if player.Needs.Warmth < 30 { lowCount++ }
    if player.Needs.Rest < 30 { lowCount++ }

    if lowCount >= 2 {
        player.Needs.Morale -= 5
        GameLog("⚠ 状況が悪化している...")
    }
}
```

### 2. 体温システム

```go
type Player struct {
    BodyTemperature float64  // 35.0-37.0℃ が正常
    ClothingStats   ClothingStats
    IsWet           bool
    Frostbite       int  // 凍傷レベル（0-3）
    Hypothermia     int  // 低体温症レベル（0-3）
}

// 体温の段階
const (
    TempNormal      = 37.0  // 正常
    TempCold        = 36.0  // 寒い（移動速度-10%）
    TempHypothermia = 35.0  // 低体温症（能力低下）
    TempCritical    = 34.0  // 危険（HP減少開始）
    TempDeath       = 32.0  // 死亡
)

// 毎ターンの体温変化
func UpdateBodyTemperature(player *Player, tile Tile) {
    ambientTemp := tile.Temperature

    // 服の保温効果
    protection := player.ClothingStats.Warmth

    // 濡れていたら保温性低下
    if player.IsWet {
        protection *= (1.0 - player.ClothingStats.Waterproof * 0.7)
    }

    // 体温変化の計算
    tempDiff := ambientTemp - player.BodyTemperature
    tempChange := tempDiff * (1.0 - protection) * 0.1

    player.BodyTemperature += tempChange

    // 低体温症の判定
    if player.BodyTemperature < TempHypothermia {
        player.Hypothermia++
        player.MovementSpeed *= 0.8
        player.MaxStamina *= 0.9
    }

    // 凍傷の判定（裸の部位がある場合）
    if ambientTemp < -20 && player.HasExposedBodyPart() {
        if rand.Float64() < (abs(ambientTemp) - 20) * 0.02 {
            player.AddFrostbite(player.GetExposedBodyPart())
            GameLog("⚠ 凍傷になった！")
        }
    }
}
```

### 3. 環境温度（部屋単位のシミュレーション）

```go
type Room struct {
    ID          RoomID
    Tiles       []Position

    // シンプルな属性
    Temperature float64  // 温度（-50℃ 〜 +20℃）
    WindSpeed   float64  // 風速（0-20 m/s）
    IsIndoor    bool     // 屋内/屋外

    // 接続
    Doors       []Door
    Fires       []Fire
}

// 環境温度の例
const (
    TempOutdoorBlizzard = -40.0  // 吹雪の中
    TempOutdoorNight    = -30.0  // 屋外・夜
    TempOutdoorDay      = -20.0  // 屋外・昼
    TempIndoorCold      = -10.0  // 屋内（暖房なし）
    TempIndoorFire      = +10.0  // 火のそば
    TempIndoorWarm      = +15.0  // 屋内（暖房あり）
)

// 部屋の温度更新
func UpdateRoomTemperature(room *Room) {
    if !room.IsIndoor {
        room.Temperature = world.OutdoorTemperature
        return
    }

    // 屋内は外気温に近づく（断熱性）
    tempDiff := world.OutdoorTemperature - room.Temperature
    room.Temperature += tempDiff * 0.05

    // 火があれば温かくなる
    for _, fire := range room.Fires {
        room.Temperature += fire.Temperature * 0.1
    }

    if room.Temperature > 20.0 {
        room.Temperature = 20.0
    }
}

// 扉を開けると温度が混ざる
func OpenDoor(door Door) {
    room1 := world.GetRoom(door.Room1)
    room2 := world.GetRoom(door.Room2)

    avgTemp := (room1.Temperature + room2.Temperature) / 2
    room1.Temperature = avgTemp
    room2.Temperature = avgTemp

    tempDiff := abs(room1.Temperature - room2.Temperature)
    if tempDiff > 10 {
        GameLog("扉を開けた。冷たい風が吹き込む！")
    }
}

// 体感温度の計算（風冷効果）
func CalculateWindChill(temp float64, windSpeed float64, windproof float64) float64 {
    effectiveWind := windSpeed * (1.0 - windproof)
    if effectiveWind < 5 {
        return temp
    }
    return temp - (effectiveWind * 0.5)
}
```

### 4. 火・暖房システム

```go
type Fire struct {
    Position      Position
    FuelRemaining float64  // 燃料残量（ターン数）
    WarmthRadius  int      // 暖かさの範囲
    Temperature   float64  // 提供する温度上昇
}

// 火を起こす
func StartFire(player *Player, position Position) bool {
    if !player.HasItem("薪") {
        GameLog("薪がない。")
        return false
    }
    if !player.HasItem("ライター") && !player.HasItem("マッチ") {
        GameLog("ライターもマッチもない。")
        return false
    }

    // 着火確率（天候による）
    tile := world.GetTile(position)
    successChance := 0.9

    if tile.IsWet {
        successChance = 0.5
        GameLog("地面が濡れている。着火は難しい...")
    }
    if tile.WindSpeed > 10 {
        successChance = 0.3
        GameLog("強風だ。火が点きにくい...")
    }

    if rand.Float64() < successChance {
        fire := Fire{
            Position:      position,
            FuelRemaining: 30.0,  // 30ターン
            WarmthRadius:  3,
            Temperature:   20.0,
        }
        world.AddFire(fire)
        player.RemoveItem("薪", 1)
        GameLog("火を起こした。温かい...")
        return true
    }

    GameLog("着火に失敗した。")
    return false
}

// 火の範囲内のプレイヤーを温める
func WarmPlayerByFire(player *Player, fire *Fire) {
    distance := Distance(player.Position, fire.Position)
    if distance <= fire.WarmthRadius {
        warmth := fire.Temperature / (1.0 + float64(distance))
        player.BodyTemperature += warmth * 0.1

        // 濡れていたら乾かす
        if player.IsWet {
            player.WetLevel -= 0.1
            if player.WetLevel <= 0 {
                player.IsWet = false
                GameLog("服が乾いた。")
            }
        }
    }
}
```

### 5. 装備システム（防寒 vs 戦闘のトレードオフ）

```go
type Clothing struct {
    // 基本情報
    Name        string
    Type        ClothingType  // 着物、コート、など
    Quality     Quality       // 粗悪〜伝説

    // 防寒性能
    Warmth      float64  // 保温性 (0.0-1.0)
    Windproof   float64  // 防風性 (0.0-1.0)
    Waterproof  float64  // 防水性 (0.0-1.0)
    Durability  int      // 耐久度

    // 機動性
    Weight          float64  // 重量 (kg)
    MovementPenalty float64  // 移動速度ペナルティ
    StaminaCost     float64  // スタミナ消費倍率

    // 戦闘性能
    DefenseBonus   int      // 防御力ボーナス
    EvasionPenalty float64  // 回避ペナルティ
    AttackPenalty  float64  // 攻撃ペナルティ
    Flexibility    float64  // 柔軟性（0.0-1.0）

    // 装備消耗
    CombatWearRate float64  // 戦闘時消耗率
    SlashResist    float64  // 斬撃耐性
    PierceResist   float64  // 刺突耐性
    TearResist     float64  // 引き裂き耐性

    // 機能性
    Pockets        int      // ポケット数（所持枠+N）
    Camouflage     float64  // 迷彩性
    Noise          float64  // 騒音
}

type ClothingType int
const (
    ClothingTypeInner  ClothingType = iota  // 肌着
    ClothingTypeMiddle                      // 中着
    ClothingTypeOuter                       // 外套
    ClothingTypeHead                        // 頭部
    ClothingTypeHands                       // 手
    ClothingTypeFeet                        // 足
)
```

#### 装備例

```go
// 極寒特化（戦闘不利）
var HeavyParkaJacket = Clothing{
    Name: "ヘビーパーカー",
    Description: "最高の防寒性能のダウンジャケット。だが動きが制限される",

    // 防寒（最高）
    Warmth: 0.95, Windproof: 0.95, Waterproof: 0.95, Durability: 300,

    // 機動性（最悪）
    Weight: 8.0, MovementPenalty: 0.4, StaminaCost: 1.6,

    // 戦闘（非常に悪い）
    DefenseBonus: 5, EvasionPenalty: 0.6, AttackPenalty: 0.4, Flexibility: 0.2,

    // 装備消耗
    CombatWearRate: 2.0, SlashResist: 0.3, PierceResist: 0.2, TearResist: 0.4,
}

// 軽装（戦闘・機動特化、寒さに弱い）
var SportJacket = Clothing{
    Name: "スポーツジャケット",
    Description: "動きやすくスリムなジャケット。だが寒い",

    // 防寒（最低）
    Warmth: 0.15, Windproof: 0.1, Waterproof: 0.05, Durability: 150,

    // 機動性（最高）
    Weight: 1.5, MovementPenalty: 0.0, StaminaCost: 0.9,

    // 戦闘（最高）
    DefenseBonus: 2, EvasionPenalty: 0.0, AttackPenalty: 0.0, Flexibility: 1.0,

    // 装備消耗
    CombatWearRate: 1.0, SlashResist: 0.1, PierceResist: 0.1, TearResist: 0.2,
}

// バランス型（フリースジャケット）
var FleeceJacket = Clothing{
    Name: "フリースジャケット",
    Description: "実用的で軽いフリース。探索に適している",

    // 防寒（中の上）
    Warmth: 0.6, Windproof: 0.55, Waterproof: 0.5, Durability: 200,

    // 機動性（良い）
    Weight: 4.0, MovementPenalty: 0.15, StaminaCost: 1.15,

    // 戦闘（良い）
    DefenseBonus: 4, EvasionPenalty: 0.1, AttackPenalty: 0.05, Flexibility: 0.8,

    // 装備消耗
    CombatWearRate: 1.2, SlashResist: 0.5, PierceResist: 0.4, TearResist: 0.6,

    // 機能性（優秀）
    Pockets: 6, Camouflage: 0.7, Noise: 0.1,
}

// 戦闘耐性が高い（ボラスコート）
var BolasCat = Clothing{
    Name: "ボラスコート",
    Description: "耐傷性の高いコート。防御と機動のバランス",

    // 防寒（中）
    Warmth: 0.45, Windproof: 0.4, Waterproof: 0.3, Durability: 180,

    // 機動性（中の上）
    Weight: 3.5, MovementPenalty: 0.1, StaminaCost: 1.1,

    // 戦闘（高い）
    DefenseBonus: 8, EvasionPenalty: 0.05, AttackPenalty: 0.0, Flexibility: 0.85,

    // 装備消耗
    CombatWearRate: 0.8, SlashResist: 0.6, PierceResist: 0.5, TearResist: 0.7,
}

// 金属製防具（廃棄施設で見つかるもの。寒さに逆効果だが防御最高）
var MetalPlateArmor = Clothing{
    Name: "金属板アーマー",
    Description: "廃棄施設に残っていた金属製防具。防御は高いが凍てつく",

    // 防寒（逆効果）
    Warmth: -0.2, Windproof: 0.0, Waterproof: 0.0, Durability: 500,

    // 機動性（悪い）
    Weight: 10.0, MovementPenalty: 0.35, StaminaCost: 1.8,

    // 戦闘（非常に高い）
    DefenseBonus: 15, EvasionPenalty: 0.3, AttackPenalty: 0.15, Flexibility: 0.6,

    // 装備消耗
    CombatWearRate: 0.5, SlashResist: 0.9, PierceResist: 0.7, TearResist: 0.95,
}

// 防水特化（カゴウLE)
var WaterproofCape = Clothing{
    Name: "防水ケープ",
    Description: "防水性は高いが保温性は低いケープ",

    Warmth: 0.1, Windproof: 0.2, Waterproof: 0.9, Durability: 80,
    Weight: 2.0, MovementPenalty: 0.25, StaminaCost: 1.2,
    DefenseBonus: 1, EvasionPenalty: 0.2, AttackPenalty: 0.1, Flexibility: 0.5,
    CombatWearRate: 1.5, SlashResist: 0.2, PierceResist: 0.1, TearResist: 0.3,
}
```

#### レイヤーシステム（重ね着）

```go
type PlayerClothing struct {
    Inner   *Clothing  // 肌着
    Middle  *Clothing  // 中着
    Outer   *Clothing  // 外套
    Head    *Clothing  // 頭部
    Hands   *Clothing  // 手
    Feet    *Clothing  // 足
}

type ClothingStats struct {
    Warmth          float64
    Windproof       float64
    Waterproof      float64
    Weight          float64
    MovementPenalty float64
    StaminaCost     float64
    DefenseBonus    int
    EvasionPenalty  float64
    AttackPenalty   float64
    Flexibility     float64
}

func CalculateClothingStats(pc PlayerClothing) ClothingStats {
    // すべての装備を合算
    var stats ClothingStats

    items := []*Clothing{pc.Inner, pc.Middle, pc.Outer, pc.Head, pc.Hands, pc.Feet}
    layerCount := 0

    for _, item := range items {
        if item == nil { continue }

        stats.Warmth += item.Warmth
        stats.Windproof += item.Windproof
        stats.Waterproof += item.Waterproof
        stats.Weight += item.Weight
        stats.MovementPenalty += item.MovementPenalty
        stats.StaminaCost *= item.StaminaCost
        stats.DefenseBonus += item.DefenseBonus
        stats.EvasionPenalty += item.EvasionPenalty
        stats.AttackPenalty += item.AttackPenalty
        stats.Flexibility = min(stats.Flexibility, item.Flexibility)  // 最も低い値

        if item.Type == ClothingTypeInner || item.Type == ClothingTypeMiddle || item.Type == ClothingTypeOuter {
            layerCount++
        }
    }

    // 3層重ねると保温性+10%
    if layerCount >= 3 {
        stats.Warmth *= 1.1
    }

    // 上限
    stats.Warmth = min(stats.Warmth, 1.0)
    stats.Windproof = min(stats.Windproof, 1.0)
    stats.Waterproof = min(stats.Waterproof, 1.0)

    return stats
}
```

#### 戦闘による装備消耗

```go
// 攻撃を受けた時の処理
func OnAttackReceived(player *Player, attack Attack) {
    clothing := player.Equipment.GetClothingAtHitLocation(attack.Location)
    if clothing == nil {
        // 裸の部位に直撃
        player.HP -= attack.Damage
        return
    }

    // 装備による防御
    defense := clothing.DefenseBonus

    // 攻撃タイプによる耐性
    var resist float64
    switch attack.Type {
    case AttackTypeSlash:
        resist = clothing.SlashResist
    case AttackTypePierce:
        resist = clothing.PierceResist
    case AttackTypeTear:
        resist = clothing.TearResist
    }

    // ダメージ計算
    actualDamage := max(0, attack.Damage - defense)
    actualDamage = int(float64(actualDamage) * (1.0 - resist))
    player.HP -= actualDamage

    // 装備の消耗
    baseLoss := attack.Damage / 2
    loss := int(float64(baseLoss) * clothing.CombatWearRate)

    // 攻撃タイプによる追加消耗
    switch attack.Type {
    case AttackTypeTear:
        loss = int(float64(loss) * (1.5 + (1.0 - clothing.TearResist)))
    }

    clothing.CurrentDurability -= loss

    // 破損判定
    if clothing.CurrentDurability <= 0 {
        OnClothingBroken(player, clothing)
    }
}

func OnClothingBroken(player *Player, clothing *Clothing) {
    GameLog(fmt.Sprintf("⚠ %sが破れた！", clothing.Name))

    // 性能激減
    clothing.EffectiveWarmth = clothing.Warmth * 0.3
    clothing.EffectiveWindproof = clothing.Windproof * 0.2
    clothing.IsTorn = true

    // この状態で外にいると凍死の危険
}
```

#### 装備の品質システム（RimWorld型）

```go
type Quality int
const (
    QualityAwful      Quality = iota  // 粗悪
    QualityPoor                       // 安物
    QualityNormal                     // 普通
    QualityGood                       // 良質
    QualityExcellent                  // 優秀
    QualityMasterwork                 // 傑作
    QualityLegendary                  // 伝説
)

// 品質による性能倍率
func GetQualityMultiplier(quality Quality) float64 {
    switch quality {
    case QualityAwful:      return 0.5
    case QualityPoor:       return 0.75
    case QualityNormal:     return 1.0
    case QualityGood:       return 1.25
    case QualityExcellent:  return 1.5
    case QualityMasterwork: return 1.8
    case QualityLegendary:  return 2.2
    }
    return 1.0
}

// ランダム生成時に品質を決定（深度で変化）
func GenerateQuality(depth int) Quality {
    roll := rand.Float64() + float64(depth) * 0.02
    switch {
    case roll < 0.15: return QualityAwful
    case roll < 0.35: return QualityPoor
    case roll < 0.70: return QualityNormal
    case roll < 0.85: return QualityGood
    case roll < 0.95: return QualityExcellent
    case roll < 0.99: return QualityMasterwork
    default:          return QualityLegendary
    }
}

// 表示名
// 「粗悪なフリースジャケット」「★伝説の★ヘビーパーカー」など
```

### 6. 思考（Thought）システム（RimWorld型）

```go
type Thought struct {
    Description string
    MoodEffect  int   // -10 〜 +10
    Duration    int   // ターン数（-1の場合は持続）
}

// イベント発生時に思考を追加
func OnEatFood(player *Player, food Food) {
    switch food.Quality {
    case QualityPoor:
        AddThought(player, Thought{"腐りかけた食事を食べた", -3, 20})
    case QualityNormal:
        AddThought(player, Thought{"食事をした", +1, 10})
    case QualityGood:
        AddThought(player, Thought{"美味しい食事を食べた", +5, 30})
    }
}

func OnEnterRoom(player *Player, room Room) {
    if room.Beauty > 80 {
        AddThought(player, Thought{"美しい景色に心が和んだ", +8, 100})
    } else if room.Beauty < 20 {
        AddThought(player, Thought{"荒廃した場所に気が滅入る", -5, 50})
    }

    if room.Temperature > 0 {
        AddThought(player, Thought{"温かい場所で一息ついた", +6, 50})
    }
}

func OnKillEnemy(player *Player, enemy Enemy) {
    if player.HasTrait("平和主義者") {
        AddThought(player, Thought{"生き物を殺してしまった...", -15, 200})
    } else if player.HasTrait("戦士") {
        AddThought(player, Thought{"強敵を倒した！", +5, 100})
    }
}

func OnWearTornClothing(player *Player, clothing Clothing) {
    AddThought(player, Thought{"ボロボロの服を着ている...", -3, -1})
}
```

### 7. 健康・負傷（部位ごと）

```go
type BodyPart int
const (
    BodyPartHead BodyPart = iota
    BodyPartTorso
    BodyPartLeftArm
    BodyPartRightArm
    BodyPartLeftLeg
    BodyPartRightLeg
)

type Injury struct {
    BodyPart   BodyPart
    Type       InjuryType  // 切り傷、打撲、凍傷
    Severity   float64     // 0.0-1.0
    IsBleeding bool
    IsBandaged bool
}

// 部位ごとの影響
func ApplyInjuryEffects(player *Player) {
    for _, injury := range player.Injuries {
        switch injury.BodyPart {
        case BodyPartHead:
            if injury.Severity > 0.5 {
                player.AccuracyPenalty += 0.3
                player.Consciousness -= 0.2
            }
        case BodyPartLeftArm, BodyPartRightArm:
            if injury.Severity > 0.3 {
                player.AttackPower *= 0.7
                player.Manipulation -= 0.3
            }
        case BodyPartLeftLeg, BodyPartRightLeg:
            if injury.Severity > 0.4 {
                player.MovementSpeed *= 0.6
                player.EvasionPenalty += 0.4
            }
        case BodyPartTorso:
            if injury.Severity > 0.6 {
                player.MaxStamina *= 0.5
                player.PainLevel += 0.5
            }
        }

        // 出血
        if injury.IsBleeding && !injury.IsBandaged {
            player.HP -= 1
            GameLog("出血している...")
        }
    }
}

// 凍傷は裸の部位に発生
func CheckFrostbite(player *Player) {
    parts := []BodyPart{BodyPartHead, BodyPartLeftArm, BodyPartRightArm, BodyPartLeftLeg, BodyPartRightLeg}

    for _, part := range parts {
        if player.HasClothingOn(part) { continue }

        if world.Temperature < -20 {
            chance := (abs(world.Temperature) - 20) * 0.02
            if rand.Float64() < chance {
                player.Injuries = append(player.Injuries, Injury{
                    BodyPart: part,
                    Type:     InjuryTypeFrostbite,
                    Severity: 0.2,
                })
                GameLog(fmt.Sprintf("⚠ %sに凍傷！", BodyPartName(part)))
            }
        }
    }
}
```

### 8. イベント管理（AI Storyteller）

```go
type StorytellerMode int
const (
    StorytellerBalanced  // バランス型
    StorytellerRelaxed   // のんびり
    StorytellerChaotic   // カオス
)

type EventManager struct {
    Mode            StorytellerMode
    TurnsSinceEvent int
    ThreatLevel     float64  // 現在の脅威レベル（0.0-1.0）
}

func (em *EventManager) GenerateEvent(world World) Event {
    if em.ThreatLevel < 0.3 {
        return ChooseRandomEvent([]Event{EventSnowfall, EventColdSnap, EventTraveler})
    } else if em.ThreatLevel < 0.7 {
        return ChooseRandomEvent([]Event{EventBlizzard, EventWolfPack, EventAvalanche})
    } else {
        return ChooseRandomEvent([]Event{EventBear, EventWolfPack, EventWhiteout})
    }
}

// 脅威レベルは深度と装備の質で変化
func (em *EventManager) UpdateThreatLevel(player Player) {
    em.ThreatLevel = float64(player.Depth) * 0.05
    em.ThreatLevel += player.EquipmentValue * 0.0001
    if em.TurnsSinceEvent > 200 {
        em.ThreatLevel *= 0.8
    }
    em.ThreatLevel = clamp(em.ThreatLevel, 0.0, 1.0)
}
```

## リソース管理

### 重要なリソース

```go
type Resources struct {
    // 燃料
    Firewood int  // 薪（火を起こす）
    Coal     int  // 炭（長時間燃える）
    Oil      int  // 灯油（ランプ、暖房）

    // 火起こし道具
    Lighter  int  // ライター（消耗品）
    Flint    int  // 火打石（耐久度あり）
    Matches  int  // マッチ（貴重、確実着火）

    // 食料
    Ration    int  // 行動食（軽く栄養があるが飽き易い）
    DriedMeat int  // 干し肉
    Whiskey   int  // ウイスキー（体温を一時的に上げる。実際には体温lowering）

    // 装備修理
    Thread      int  // 修理用スレッド
    DuctTape    int  // ダクトテープ（応急修理用）

    // 医薬品
    Bandage  int  // 包帯（止血・凍傷治療）
    Medicine int  // 薬（低体温症治療）
}
```

### リソースのトレードオフ

```
薪の使い道:
1. 火を起こす（暖を取る）
2. 松明を作る（照明）
3. 廃棄施設で見つかった物と交換
→ 何に使うか判断

マッチ vs ライター:
- マッチ: 確実に着火、でも数が限られる
- ライター: 風には弱い、残り量が見えない
→ いつ使うか判断

ウイスキーの偽トレードオフ:
- 飲むと「温かい」と感じる
- でも実際には体温をさらに下げる
- 錯覚に骙かされてはいけない
```

## 戦闘と装備の戦術的シチュエーション

### シチュエーション1: 雪狼の群れ遭遇

```
状況:
- 雪狼5匹
- 気温-30℃
- 火を起こす時間なし

選択肢A: 重装防寒装備で戦闘
✓ 寒さは問題なし
✗ 回避-60%（狼の攻撃がまくる）
✗ 攻撃-40%（反撃が弱い）
✗ 爪・牙で装備がボロボロになる
→ 装備破損のリスク大

選択肢B: 戦闘装備に着替えて戦闘
✓ 回避ペナルティなし（避けられる）
✓ 攻撃ペナルティなし
✗ 戦闘後に極寒（体温急降下）
✗ 急いで火を起こさないと凍死
→ 戦闘には勝てるが、その後が危険

選択肢C: 逃走
✓ 戦闘回避
✗ 重装備だと追いつかれる
✓ 軽装なら逃げ切れる
→ 軽装に着替えて逃走

→ 正解はない、状況判断が重要
```

### シチュエーション2: ボス（熊）戦

```
戦略A: 金属板アーマーで正面突破
✓ 防御力最高
✗ 金属で寒い（保温-0.2）
✗ 長期戦になると凍える

戦略B: 軽装で短期決戦
✓ 機動性最高
✗ 一撃が重いと死ぬ
✗ 装備が消耗しやすい

戦略C: 着替え戦術（上級者）
1. 防寒装備で近づく
2. 戦闘直前に軽装に着替え
3. 短期決戦
4. 戦闘後すぐ防寒装備に戻す
✓ 両方の利点を活かす
✗ 着替えに1ターン必要
```

### シチュエーション3: 吹雪中の戦闘

```
吹雪の中で狼の群れが出現。逃げられない。

問題:
- 戦闘装備だと凍死
- 防寒装備だと戦闘不利
- 戦闘で防寒装備が破れると確実死

解決策:
1. 廃棄施設の室内に引き込む（1ターン）
   → 屋内 = 体温維持
   → 狭い入口で数を減らせる

2. 特殊アイテム使用
   → 暖好剤パック（使い捨て体温+20）
   → 暖好剤で凍死回避しつつ戦闘

→ 事前の準備とアイテム管理が鍵
```

## 敵の設計

### 環境的脅威（主役70%）

```
1. 吹雪: 視界ゼロ、体温急降下、迷子
2. 雪崩: 特定エリアで発生、大ダメージ
3. 氷の床: 滑る、制御不能
4. 凍傷: 徐々に進行、放置すると壊死
5. 強風: 移動困難、着火困難
```

### 生物的脅威（副次的30%）

```
1. 狼の群れ
   - 群れで襲う（3-6匹）
   - 夜行性
   - 火を恐れる

2. 熊
   - 廃棄施設の近くに棲む
   - 高い攻撃力と体力
   - エリアのボス級

3. 野生犬の群れ
   - 廃棄施設の廃墟に棲む
   - 素早い
   - 上位エリアに出現する種が特に危険

4. 鷲・独身の猛禽類
   - 上位エリアに出現
   - 上からの突撃攻撃
   - 追撃が速い
```

## ゲームループ

### 1日のサイクル

```
早朝（安全）: 気温-20℃、視界良好
昼（最適）:   気温-15℃、探索に最適
夕方（警戒）: 気温-25℃、拠点へ戻る時間
夜（危険）:   気温-35℃、野生動物活動、屋内で休む
吹雪（極危険）: 気温-45℃、視界ゼロ、外出不可
```

### 探索の流れ

```
1. 準備フェーズ（廃棄小屋・拠点）
   - 廃棄施設から装備を整える
   - 薪、食料を収集
   - 何を持つか選択（重量制限）

2. 探索フェーズ
   - 山を進む
   - 廃棄施設や小屋を探索
   - 物資を回収
   - 体温管理

3. 帰還判断（「もう少し」の誘惑）
   - 燃料の残量
   - 体温の限界
   - 天候の変化
   → 欲張ると死ぬ

4. 帰還フェーズ
   - 安全な拠点に戻る
   - 回収した物資を活用
   - 成長、次の探索に備える
```

## UIとフィードバック

### ステータス表示

```
┌──────────────────────────────────┐
│ HP: ████████ 80/100              │
│ 🌡️  体温: 36.2℃ [寒い]          │ ← 色で表示（青=寒い）
│ 🍚 空腹: ██████░░ 60%           │
│ 💧 渇き: █████░░░ 50%           │
│ 💤 疲労: ████████░ 80%          │
│                                   │
│ 装備:                            │
│ 🧥 保温: ██████░░░ 60%          │
│ 💨 防風: █████░░░░ 50%          │
│ 💧 防水: ████░░░░░ 40%          │
│ ⚔️  戦闘: █████░░░░ 50%          │
│ 🏃 機動: ██████░░░ 60%          │
│                                   │
│ 環境:                            │
│ 📍 標高: 1,200m                  │
│ 🌡️  気温: -28℃ [危険]           │
│ 💨 風速: 12m/s [強風]           │
│ 🌨️  天候: 吹雪 [警戒]           │
│ ⏰ 時刻: 15:30 (夕方)           │
└──────────────────────────────────┘
```

### 装備比較画面

```
┌──────────────────────────────────┐
│ 装備比較: 防寒装備 vs 戦闘装備   │
│                                   │
│         防寒装備    戦闘装備      │
│ 保温:     95%   →   15%  ⬇️⬇️   │
│ 防風:     95%   →   10%  ⬇️⬇️   │
│ 防御:    +5     →   +2   ⬇️     │
│ 攻撃:   -40%    →   ±0   ⬆️⬆️   │
│ 回避:   -60%    →   ±0   ⬆️⬆️   │
│ 機動:   -40%    →   ±0   ⬆️⬆️   │
│                                   │
│ ⚠ 戦闘装備は寒さに弱い！        │
│ 気温-30℃では10ターンで低体温症  │
│                                   │
│ 💡 推奨: 戦闘前に着替え、        │
│ 戦闘後すぐ戻す                   │
└──────────────────────────────────┘
```

### 装備破損時の警告

```
┌──────────────────────────────────┐
│ ⚠⚠⚠ 装備破損！⚠⚠⚠             │
│                                   │
│ 狼の爪がフリースジャケットを引き裂いた！│
│                                   │
│ 性能低下:                        │
│ 保温性: 60% → 18% (-70%)        │
│ 防風性: 55% → 11% (-80%)        │
│                                   │
│ このままでは凍死する！           │
│                                   │
│ [応急修理](糸1、ダクトテープ1) - 3ターン │
│ [他の装備に着替える]            │
│ [このまま戦闘続行] (危険)       │
└──────────────────────────────────┘
```

### 警告システム

```
レベル1（注意）:
「体温が下がっている。服を着るか火を起こそう」

レベル2（警戒）:
「⚠ 体温が危険域。早急に対策を！」

レベル3（緊急）:
「⚠⚠⚠ 低体温症！このままでは死ぬ！」

レベル4（致命的）:
「意識が遠のいていく...」
→ 数ターン以内に対処しないと死亡
```

## 実装優先度

```
Phase 1: 基本システム
✓ プレイヤーのニーズ（体温、空腹、疲労）
✓ 環境温度（部屋単位）
✓ 火を起こす
✓ 基本的な装備（防寒 vs 戦闘）

Phase 2: 環境要素
✓ 屋内/屋外の違い
✓ 天候（晴れ、曇り、吹雪）
✓ 時間帯（昼、夜）
✓ 扉の開閉による温度変化

Phase 3: 装備の深み
✓ レイヤーシステム（重ね着）
✓ 装備の消耗（戦闘による）
✓ 品質システム（ランダム生成で差がつく）
✓ 修理システム

Phase 4: 敵と危険
✓ 狼の群れ（基本的な敵）
✓ 吹雪イベント
✓ 凍傷、低体温症
✓ 熊・猛禽類（上位敵）

Phase 5: ゲームループ
✓ 拠点での準備フェーズ
✓ 探索と帰還の判断
✓ 思考システム
✓ 死亡サマリー（Emergent Narrative）

Phase 6: 深みの追加
✓ スキル成長
✓ AI Storyteller
✓ 社交（廃棄施設で遭遇するNPC）
✓ エンドコンテンツ（山を下り切る）
```

## 参考ゲームとの関係

| ゲーム | 参考にすること |
|--------|--------------|
| The Long Dark | Overall設計、体温管理、リソース管理、「もう少し」の誘惑 |
| FTL | リソース交換の戦術性、短時間セッション |
| RimWorld | ニーズシステム、思考システム、品質、AIストーリーテラー |
| Spelunky | 環境利用、ランダム生成と環境の両立 |
| Noita | 物理シミュレーション、予測不能な連鎖 |
| CDDA | 地形の戦術利用、装備の複雑さ |

## 設計の原則まとめ

```
1. 環境がプレッシャー（敵は副次的）
2. シンプルなルール、複雑な結果
3. 属性は部屋単位で管理（タイル単位の複雑な計算なし）
4. 装備は「防寒 vs 戦闘」のトレードオフ
5. 戦闘で装備が消耗する
6. リソースは常に足りない状態を維持
7. ソフトな時間制約（体温が見えない追跡者）
8. 引き際の判断が勝負を分ける
9. 物語は自然に生まれる（プログラムされたイベントではない）
10. ランダム生成可能（ルールは固定、配置は自由）
```
